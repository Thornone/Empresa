var ptssCargoPress=ptssCargoPress||{};ptssCargoPress.events={};_.extend(ptssCargoPress.events,Backbone.Events);jQuery(document).ready(function($){new ptssCargoPress.frameView({el:'.js-ptss-frame',model:new ptssCargoPress.Frame(),});$('body').append($('<style id="ptss__skin-css" />'));new ptssCargoPress.cssView({el:'#ptss__skin-css',});new ptssCargoPress.pageLayoutView({el:'#ptss__layout',model:ptssCargoPress.PageLayout,});new ptssCargoPress.colorPaletteView({el:'#ptss__color-skin',});});(function(){var $=jQuery;ptssCargoPress.Frame=Backbone.Model.extend({defaults:{isVisible:false,},initialize:function(){var current=localStorage.getItem(ptssVars.siteId+'_isVisible');if(null===current){this.set('isVisible',true);setTimeout(_.bind(this.toggleVisibility,this),2000);}
else{this.set('isVisible','true'===current);}},toggleVisibility:function(){this.set('isVisible',!this.get('isVisible'));localStorage.setItem(ptssVars.siteId+'_isVisible',this.get('isVisible'));},});ptssCargoPress.frameView=Backbone.View.extend({events:{'click .js-ptss-toggle-btn':'toggleVisibility',},initialize:function(){this.listenTo(this.model,'change',this.toggleClass);this.model.trigger('change');},toggleVisibility:function(){this.model.toggleVisibility();},toggleClass:function(){this.$el.toggleClass('is-opened',this.model.get('isVisible'));},});(function(){var Layout=Backbone.Model.extend({defaults:{isBoxed:false,},initialize:function(){this.listenTo(this,'change',this.bodyClass);this.set('isBoxed','true'===localStorage.getItem(ptssVars.siteId+'_isBoxed'));},switchLayout:function(){this.set('isBoxed',!this.get('isBoxed'));localStorage.setItem(ptssVars.siteId+'_isBoxed',this.get('isBoxed'));ptssCargoPress.events.trigger('toggleLayoutStyle',this.get('isBoxed'));$(window).trigger('resize');},bodyClass:function(){$('body').toggleClass('boxed',this.get('isBoxed'));},});ptssCargoPress.PageLayout=new Layout();})();ptssCargoPress.ColorSkin=Backbone.Model.extend({defaults:{isSelected:false,color:'',},initialize:function(){this.listenTo(this,'change:isSelected',this.applySkin);},applySkin:function(){if(this.get('isSelected')){ptssCargoPress.events.trigger('updateCSS');localStorage.setItem(ptssVars.siteId+'_colorSkin',this.get('color'));}},});ptssCargoPress.colorPaletteCollection=Backbone.Collection.extend({model:ptssCargoPress.ColorSkin,initialize:function(){setTimeout(_.bind(this.setDefaultSkin,this),20);},setDefaultSkin:function(){var current=localStorage.getItem(ptssVars.siteId+'_colorSkin');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(colorSkin){return current===colorSkin.get('color');}).set('isSelected',true);}}});ptssCargoPress.colorPalette=new ptssCargoPress.colorPaletteCollection([{color:'default',css:{linkButton:'#4ab9cf',linkButtonDarken5:'#35b1ca',darker:'#1f425d',darkerDarken7:'#162e41',darkerDarken10:'#122636',primary:'#e21f2f',primaryDarken8:'#be1926',},},{color:'green',css:{linkButton:'#2aa45d',linkButtonDarken5:'#248e51',darker:'#333333',darkerDarken7:'#212121',darkerDarken10:'#1a1a1a',primary:'#2aa45d',primaryDarken8:'#21824a',},},{color:'gray',css:{linkButton:'#eb1d65',linkButtonDarken5:'#d81358',darker:'#3f498f',darkerDarken7:'#333c75',darkerDarken10:'#2f366a',primary:'#abadbd',primaryDarken8:'#9295aa',},},{color:'orange',css:{linkButton:'#95ae47',linkButtonDarken5:'#d81358',darker:'#4a485f',darkerDarken7:'#383749',darkerDarken10:'#323040',primary:'#fa7455',primaryDarken8:'#f9512a',},},{color:'gold',css:{linkButton:'#2c497d',linkButtonDarken5:'#253e6a',darker:'#444444',darkerDarken7:'#303030',darkerDarken10:'#292929',primary:'#e38222',primaryDarken8:'#c36d19',},},]);ptssCargoPress.BgImage=Backbone.Model.extend({defaults:{isSelected:false,repeatable:false,name:'',src:{},},initialize:function(){this.listenTo(this,'change:isSelected',this.updateBgImage);},updateBgImage:function(){if(this.get('isSelected')){ptssCargoPress.events.trigger('updateBgImage');localStorage.setItem(ptssVars.siteId+'_bgImage',this.get('name'));}},});ptssCargoPress.bgImgsCollection=Backbone.Collection.extend({model:ptssCargoPress.BgImage,initialize:function(){setTimeout(_.bind(this.setDefaultBg,this),20);},setDefaultBg:function(){var current=localStorage.getItem(ptssVars.siteId+'_bgImage');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(bgImg){return current===bgImg.get('name');}).set('isSelected',true);}}});ptssCargoPress.bgImgs=new ptssCargoPress.bgImgsCollection([{name:'pattern1',src:'0.png',sprite:1,},{name:'pattern2',src:'1.png',sprite:2,},{name:'pattern3',src:'2.png',sprite:3,},{name:'pattern4',src:'3.png',sprite:4,},{name:'pattern5',src:'4.png',sprite:5,},{name:'pattern6',src:'5.png',sprite:6,},{name:'pattern7',src:'6.png',sprite:7,}]);ptssCargoPress.pageLayoutView=Backbone.View.extend({events:{'click .ptss__layout-box--wide':'changeToWide','click .ptss__layout-box--boxed':'changeToBoxed',},template:_.template($('#ptss-layout-tmpl').html()),initialize:function(){this.listenTo(this.model,'change',this.render);this.render();return this;},render:function(){this.$('.ptss__setting-control').html(this.template(this.model.attributes));return this;},changeToWide:function(ev){if(this.model.get('isBoxed')){this.model.switchLayout();}
return this;},changeToBoxed:function(ev){if(!this.model.get('isBoxed')){this.model.switchLayout();}
return this;},});ptssCargoPress.colorSkinView=Backbone.View.extend({events:{'click':'changeToThisSkin',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__color-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-color',this.model.attributes.css.linkButton);return this;},changeToThisSkin:function(){ptssCargoPress.colorPalette.each(function(colorSkin){colorSkin.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssCargoPress.colorPaletteView=Backbone.View.extend({initialize:function(){ptssCargoPress.colorPalette.each(this.addColorSkin,this);return this;},addColorSkin:function(colorSkin){var skinView=new ptssCargoPress.colorSkinView({model:colorSkin,});this.$el.append(skinView.render().el);},});ptssCargoPress.bgImgView=Backbone.View.extend({events:{'click':'changeToThisBgImg',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__bgimg-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-position','-'+((this.model.get('sprite')- 1)*30)+'px 0');return this;},changeToThisBgImg:function(){ptssCargoPress.bgImgs.each(function(bgImg){bgImg.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssCargoPress.bgImgsView=Backbone.View.extend({initialize:function(){ptssCargoPress.bgImgs.each(this.addBgImgs,this);return this;},addBgImgs:function(bgImg){var bgImgView=new ptssCargoPress.bgImgView({model:bgImg,});this.$('#ptss__boxed-backgrounds').append(bgImgView.render().el);}});ptssCargoPress.cssView=Backbone.View.extend({template:_.template($('#ptss-css-selectors-tmpl').html()),initialize:function(){this.listenTo(ptssCargoPress.events,'updateCSS updateBgImage',this.render);return this;},render:function(){var selectedColorSkin=ptssCargoPress.colorPalette.find(function(colorSkin){return colorSkin.get('isSelected');});var selectedBg=ptssCargoPress.bgImgs.find(function(bgImg){return bgImg.get('isSelected');});if(!_.every([selectedColorSkin,selectedBg])){return;}
this.$el.text(this.template({skin:selectedColorSkin.attributes,bg:selectedBg.attributes,pathToPlugin:ptssVars.pathToPlugin,}));return this;},});})();